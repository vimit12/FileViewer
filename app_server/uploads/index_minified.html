<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1" name="viewport"><!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icon library -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" rel="stylesheet">
    <title class="report">Report</title>

    <style>.table-container{height:80vh;overflow:auto}.urgent-table-container{overflow:auto}.table-responsive{width:1000px;overflow-x:auto;overflow-y:auto}.fixed-header thead{position:sticky;top:0;z-index:1;background-color:#343a40}.custom-th{width:150px}.custom-modal{height:80vh}.overflow-auto{overflow-x:auto;overflow-y:auto}.dropdown-custom{max-height:200px;overflow-y:auto}.day-dropdown{max-height:200px;overflow-y:auto}.card-body{max-height:50vh;overflow-y:auto}.clickable-card{cursor:pointer}</style>
</head>

<body>
    <div class="container-xl mt-4">
        <!-- Urgent Action item -->
        <div class="row">
            <div class="col">
                <div class="alert alert-danger mt-4" role="alert" style="background-color: rgb(246, 91, 91);">
                    <div class="d-flex clickable-card" onclick="actionCollapse()">
                        <div class="p-6 w-100">
                            Immediate Action Required :
                        </div>
                        <div class="p-6 flex-shrink-1 clickable-card">
                            <i class="bi bi-arrows-collapse" data-bs-custom-class="custom-tooltip"
                                data-bs-placement="top" data-bs-toggle="tooltip" id="action_title_change"
                                title="Collapse"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="urgentData" id="urgentData">
            <div class="row">
                <div class="col">
                    <div class="d-flex">
                        <div class="p-2 flex-grow-1"></div>
                        <div class="p-3">
                            Days Left :
                        </div>
                        <div class="p-2">
                            <div class="dropdown dropend">
                                <button aria-expanded="false" class="btn btn-outline-warning dropdown-toggle btn-sm"
                                    data-bs-toggle="dropdown" id="daysDropdown" type="button">Select Days</button>
                                <ul aria-labelledby="daysDropdown" class="dropdown-menu mt-4 day-dropdown">
                                    <li>
                                        <a class="dropdown-item" data-days="1" href="#">1 Day</a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" data-days="2" href="#">2 Days</a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" data-days="3" href="#">3 Days</a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" data-days="4" href="#">4 Days</a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" data-days="5" href="#">5 Days</a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" data-days="6" href="#">6 Days</a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" data-days="7" href="#">7 Days</a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" data-days="8" href="#">8 Days</a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" data-days="9" href="#">9 Days</a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" data-days="10" href="#">10 Days</a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" data-days="11" href="#">11 Days</a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" data-days="12" href="#">12 Days</a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" data-days="13" href="#">13 Days</a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" data-days="14" href="#">14 Days</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div>
                    <div class="urgent-modal-body urgent-table-container">
                        <p>This is the content of the urgent item. Please select days to view items that are going to
                            impact the resource.</p>
                    </div>
                </div>
            </div>
        </div><!-- Summary Tab -->
        <div class="row">
            <div class="col">
                <div class="alert alert-warning mt-4" role="alert">
                    <div class="d-flex clickable-card" onclick="summaryCollapse()">
                        <div class="p-6 w-100">
                            Summarised data :
                        </div>
                        <div class="p-6 flex-shrink-1 clickable-card">
                            <i class="bi bi-arrows-collapse" data-bs-custom-class="custom-tooltip"
                                data-bs-placement="top" data-bs-toggle="tooltip" id="summary_title_change"
                                title="Collapse"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="summary-container mb-4" id="summary-container">
            <!-- Data will be populated here by JavaScript -->
        </div><!-- RAW DATA Tab -->
        <div class="row">
            <div class="col">
                <div class="alert alert-warning mt-4" role="alert">
                    <div class="d-flex clickable-card" onclick="rawCollapse()">
                        <div class="p-6 w-100">
                            Raw data :
                        </div>
                        <div class="p-6 flex-shrink-1">
                            <i class="bi bi-arrows-collapse" data-bs-custom-class="custom-tooltip"
                                data-bs-placement="top" data-bs-toggle="tooltip" id="raw_title_change"
                                title="Collapse"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div><!-- Search Bar -->
        <div class="rawData" id="rawData">
            <div class="row mb-4">
                <div class="col-10">
                    <input class="form-control" id="searchInput" placeholder="Search..." type="text">
                </div>
                <div class="col-2">
                    <button class="btn btn-outline-warning" onclick="reset()" style="width: 100%;"
                        type="button">Reset</button>
                </div>
            </div>
            <div class="table-container" id="table-container">
                <!-- Data will be populated here by JavaScript -->
            </div>&nbsp;&nbsp;&nbsp;
        </div><!-- Modal -->
        <div aria-hidden="true" aria-labelledby="exampleModalLabel"
            class="modal fade modal-lg custom-modal modal-dialog-scrollable" id="exampleModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Column Name <i class="bi bi-sort-alpha-up"></i>
                        </h5><button aria-label="Close" class="btn-close" data-bs-dismiss="modal"
                            type="button"></button>
                    </div>
                    <div class="modal-body overflow-auto" id="nestedTableContainer" style="word-wrap: break-word;">
                        <!-- Your long content goes here -->
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Close</button>
                    </div>
                </div>
            </div>
        </div><!-- Bootstrap Bundle with Popper -->
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js">
        </script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js">
        </script>
        <script>
            let currentSortColumn=null,isAscending=!0;var countsObj={},targetArray=null,selectedDays=null;const jsonData=%JSON_DATA%;function reset(){targetArray=null,renderTable(sortKeys(jsonData))}function actionCollapse(){const e=document.getElementById("urgentData"),t=document.getElementById("action_title_change");if("Collapse"===t.title)t.title="Expand";else{t.title="Collapse",document.getElementById("daysDropdown").textContent="Select Days",document.querySelector(".urgent-modal-body").innerHTML="<p>This is the content of the urgent item. Please select days to view items that are going to impact the resource.</p>"}const n="none"!==e.style.display;e.style.display=n?"none":"block"}function summaryCollapse(){const e=document.getElementById("summary-container"),t=document.getElementById("summary_title_change");"Collapse"===t.title?t.title="Expand":t.title="Collapse";const n="none"!==e.style.display;e.style.display=n?"none":"block"}function rawCollapse(){const e=document.getElementById("rawData"),t=document.getElementById("raw_title_change");"Collapse"===t.title?t.title="Expand":(t.title="Collapse",reset());const n="none"!==e.style.display;e.style.display=n?"none":"block"}function getEpochTimeForSelectedDay(e){const t=Date.now()+24*e*60*60*1e3;return Math.floor(t/1e3)}function filterDataByDays(e,t){return jsonData.filter(t=>{if(null===t.EndTime||"null"===t.EndTime||void 0===t.EndTime)return!1;const n=Math.floor(Date.now()/1e3);return t.EndTime<=e&&n<=t.EndTime})}function epochToDatetime(e){return new Date(1e3*e).toUTCString()}function handleCardClick(){new bootstrap.Modal(document.getElementById("urgentModal")).show()}function countValuesForKey(e){const t={};return jsonData.forEach(n=>{let a;a="object"==typeof n[e]?JSON.stringify(n[e]):n[e],t[a]=(t[a]||0)+1}),t}function groupByKey(){return Object.keys(jsonData[0]).forEach(e=>{const t=countValuesForKey(e);countsObj[e]=t}),countsObj}function getValuesByKey(e,t){let n=new Set;return e.forEach(e=>{e.hasOwnProperty(t)&&n.add(e[t])}),Array.from(n)}function truncateString(e,t){return e.length<=t?e:e.slice(0,t)+"..."}function sortKeys(e){function t(e){return Object.keys(e).sort().reduce((t,n)=>(t[n]=e[n],t),{})}return Array.isArray(e)?e.map(e=>t(e)):"object"==typeof e?t(e):e}document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("daysDropdown");document.querySelector("#daysDropdown + .dropdown-menu").addEventListener("click",function(t){(selectedDays=t.target.dataset.days)&&(e.textContent=`${selectedDays} Day${selectedDays>1?"s":""}`);const n=document.querySelector(".urgent-modal-body"),a=sortKeys(filterDataByDays(getEpochTimeForSelectedDay(selectedDays),getEpochTimeForSelectedDay(selectedDays+1)));if(a.length>0){const e=["AccountName","AffectedAccount","AffectedResource","EndTime","Service","Status","event"];let t='<table class="table table-bordered table-striped fixed-header">';t+="<thead><tr>",e.forEach(e=>{t+=`<th class="table-info custom-th">${e}</th>`}),t+="</tr></thead>",t+="<tbody>",a.forEach(n=>{t+="<tr>",e.forEach(e=>{t+="EndTime"===e?`<td>${epochToDatetime(n[e])}</td>`:`<td>${n[e]}</td>`}),t+="</tr>"}),t+="</tbody></table>",n.innerHTML=t}else n.innerHTML="<p>No data available for the selected criteria.</p>"})});const sortedData=sortKeys(jsonData);function filterItemsByKeyValue(e,t,n){return e.filter(e=>e[t]==n)}function handleDropdownSelection(e,t){null==targetArray&&(targetArray=[...jsonData]),console.log("Selected value:",e,t,targetArray.length),"null"==t&&(t=null);const n=filterItemsByKeyValue(targetArray,e,t);targetArray=[...n],renderTable(sortKeys(n))}function renderTable(e){const t=document.getElementById("table-container");t.innerHTML="";try{const n=e,a=Object.keys(n[0]),o=document.createElement("table");o.className="table table-bordered table-striped fixed-header";const r=document.createElement("thead"),l=document.createElement("tr");a.forEach(e=>{const t=document.createElement("th");if(t.className="table-info custom-th","Description"==e||"event"==e)t.textContent=e;else{const a=document.createElement("div");a.className="btn-group";const o=getValuesByKey(n,e);let r="";o.forEach(t=>{r+=`<li><a class="dropdown-item" href="#" onclick="handleDropdownSelection('${e}','${t}')">${t}</a></li>`}),a.innerHTML=`<button class="btn btn-secondary btn-sm dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown"\n                     aria-expanded="false">\n                     ${e}\n                 </button>\n                 <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton" style="max-height: 200px; overflow-y: auto;">\n                     ${r}\n                 </ul>`,t.appendChild(a)}l.appendChild(t)}),r.appendChild(l),o.appendChild(r);const c=document.createElement("tbody");n.forEach(e=>{const t=document.createElement("tr");a.forEach(n=>{const a=document.createElement("td"),o="string"==typeof e[n]?e[n]:JSON.stringify(e[n]);a.textContent=o,a.setAttribute("data-original-content",o),o&&o.length>50?a.textContent=truncateString(o,75):a.textContent=o||"N/A",a.addEventListener("click",()=>{handleClick(a.getAttribute("data-original-content"),n)}),t.appendChild(a)}),c.appendChild(t)}),o.appendChild(c),t.appendChild(o)}catch(e){console.log(e),t.textContent="No Record Found!!"}}function createCard(){const e=document.getElementById("summary-container");e.innerHTML="";const t=groupByKey(),n=document.createElement("div");n.className="container";const a=document.createElement("div");a.className="row ";for(const e in t)if(("Region"==e||"AccountName"==e||"Service"==e||"AffectedAccount"==e)&&t.hasOwnProperty(e)){const n=t[e],o=document.createElement("div");o.className="col-md-12 mt-4";const r=document.createElement("div");r.className="card";const l=document.createElement("div");l.className="card-body";const c=document.createElement("h5");c.className="card-title",c.textContent="Group by Data for "+e+" :";const d=document.createElement("table");d.className="table table-hover table-bordered table-striped fixed-header";const s=document.createElement("thead"),i=document.createElement("tr"),u=document.createElement("th");u.textContent="Value",u.style.backgroundColor="#bef4f7";const y=document.createElement("th");y.textContent="Count",y.style.backgroundColor="#bef4f7",i.appendChild(u),i.appendChild(y),s.appendChild(i);const m=document.createElement("tbody");for(const t in n)if(n.hasOwnProperty(t)){const a=document.createElement("tr"),o=document.createElement("td");t.length>30?o.textContent=truncateString(t,30):o.textContent=t,o.setAttribute("data-original-content",t),o.addEventListener("click",()=>{handleClick(o.getAttribute("data-original-content"),e)});const r=document.createElement("td");r.textContent=n[t],a.appendChild(o),a.appendChild(r),m.appendChild(a)}d.appendChild(s),d.appendChild(m),l.appendChild(c),l.appendChild(d),r.appendChild(l),o.appendChild(r),a.appendChild(o)}n.appendChild(a),e.appendChild(n)}function searchInData(e,t){return Object.values(e).some(e=>"object"==typeof e&&null!==e?searchInData(e,t):!("string"!=typeof e||!e.toLowerCase().includes(t)))}function identifyArrayType(e){return"object"!=typeof e||null===e||Array.isArray(e)?"string"!=typeof e||null===e||Array.isArray(e)?"number"!=typeof e||null===e||Array.isArray(e)?0===e.length?"Empty array":e.every(e=>Array.isArray(e))?"Array of arrays":e.every(e=>"object"==typeof e&&null!==e&&!Array.isArray(e))?"Array of objects":e.every(e=>"string"==typeof e)?"Array of strings":e.every(e=>"number"==typeof e)?"Array of numbers":e.every(e=>"boolean"==typeof e)?"Array of booleans":"Mixed array":"numbers":"string":"objects"}function handleClick(e,t){document.getElementById("exampleModalLabel").textContent=t+" : ";const n=document.getElementById("nestedTableContainer"),a=e;let o;try{o=JSON.parse(a)}catch(e){o=a}let r=identifyArrayType(o);"Array of objects"===r||"objects"===r?renderNestedTable(o,n,r):n.textContent=e,new bootstrap.Modal(document.getElementById("exampleModal")).show()}function renderNestedTable(e,t,n){const a="objects"===n?[e]:e;t.innerHTML="";try{const e=Object.keys(a[0]),n=document.createElement("table");n.className="table table-bordered table-striped align-middle";const o=document.createElement("thead"),r=document.createElement("tr");e.forEach(e=>{const t=document.createElement("th");t.textContent=e,t.className="table-primary",r.appendChild(t)}),o.appendChild(r),n.appendChild(o);const l=document.createElement("tbody");a.forEach(t=>{const n=document.createElement("tr");e.forEach(e=>{const a=document.createElement("td");let o=t[e];"object"==typeof o&&(o=JSON.stringify(o),a.classList.add("nested-data"),a.addEventListener("click",()=>{handleClick(a,e)})),a.textContent=o,n.appendChild(a)}),l.appendChild(n)}),n.appendChild(l),t.appendChild(n)}catch(e){t.textContent="No Record Found!!"}}window.onload=function(){renderTable(sortedData),createCard()},searchInput.addEventListener("input",()=>{const e=searchInput.value.trim().toLowerCase();renderTable(sortKeys(jsonData.filter(t=>searchInData(t,e))))});



        </script>
    </div>
</body>

</html>
